import{j as o,a as i}from"./vendor-react-Bifdz3QC.js";const j={id:"workflows",icon:"fa-folder-tree",title:"Workflows"};function E(){return(window.wpApiSettings&&window.wpApiSettings.root||window.wp&&window.wp.apiSettings&&window.wp.apiSettings.root||"/wp-json/").replace(/\/$/,"")}function $(){if(document.getElementById("yolandi-workflows-css"))return;const s=`
  .yol-wfs { display:flex; flex-direction:column; height:100%; background:#0f172a; color:#e5e7eb; font-size:13px; }
  .yol-wfs__hdr { display:flex; align-items:center; justify-content:space-between; padding:10px 12px; border-bottom:1px solid #1f2937; }
  .yol-wfs__title { font-weight:700; letter-spacing:.2px; }
  .yol-wfs__search { padding:8px 10px; border-bottom:1px solid #1f2937; }
  .yol-wfs__search input { width:100%; padding:6px 8px; border-radius:6px; background:#0b1220; border:1px solid #233046; color:#e5e7eb; }
  .yol-wfs__tree { overflow:auto; padding:6px 0 12px; flex:1; }
  .yol-wfs__section { margin-top:10px; }
  .yol-wfs__sectionTitle { font-size:11px; text-transform:uppercase; opacity:.7; padding:6px 10px; border-left:3px solid #334155; }
  .yol-tree__row { padding:4px 10px; line-height:1.5; user-select:none; cursor:pointer; }
  .yol-tree__row:hover { background:rgba(148,163,184,.08); }
  .yol-tree__file { display:flex; align-items:center; }
  .yol-empty { padding:12px; opacity:.7; }
  `,n=document.createElement("style");n.id="yolandi-workflows-css",n.textContent=s,document.head.appendChild(n)}function L({open:s}){return o.jsx("span",{className:`inline-block transition-transform duration-150 mr-1 ${s?"rotate-90":""}`,style:{width:12,display:"inline-block",textAlign:"center"},children:"â–¶"})}function N({node:s,baseKey:n,depth:d,expanded:p,toggle:w,onOpen:a}){const f=8+d*12;if(s.type==="dir"){const u=s.rel||s.name,x=!!p[u];return o.jsxs("div",{children:[o.jsxs("div",{className:"yol-tree__row",style:{paddingLeft:f},onClick:()=>w(u),title:s.rel||s.name,children:[o.jsx(L,{open:x}),o.jsx("strong",{children:s.name})]}),x&&(s.children||[]).map(c=>{var h;return o.jsx(N,{node:c,baseKey:n,depth:d+1,expanded:p,toggle:w,onOpen:a},`${c.type}-${(h=c.rel)!=null?h:c.name}`)})]})}return o.jsxs("div",{className:"yol-tree__row yol-tree__file",style:{paddingLeft:f+16},onClick:()=>a(n,s),title:s.rel||s.name,children:[o.jsx("span",{style:{marginRight:6},children:"ðŸ“„"}),o.jsx("span",{children:s.name})]})}function P(){function s(){$();const[n,d]=i.useState([]),[p,w]=i.useState(!0),[a,f]=i.useState(""),[u,x]=i.useState(""),[c,h]=i.useState(()=>{var e;try{return(e=JSON.parse(localStorage.getItem("yolandi.workflows.expanded")))!=null?e:{}}catch{return{}}}),v=i.useCallback(e=>{h(r=>{const t=typeof e=="function"?e(r):e;try{localStorage.setItem("yolandi.workflows.expanded",JSON.stringify(t))}catch{}return t})},[]),C=i.useCallback(e=>v(r=>({...r,[e]:!r[e]})),[v]);i.useEffect(()=>{(async()=>{w(!0),f("");try{const e=E(),r=await fetch(`${e}/yolandi/v1/workflows`,{credentials:"same-origin"});if(!r.ok)throw new Error(`HTTP ${r.status}`);const t=await r.json();d(Array.isArray(t)?t:[])}catch{f("Workflows API unavailable"),d([])}finally{w(!1)}})()},[]);const T=i.useCallback(async(e,r)=>{var t,m;try{const g=E(),k=new URL(`${g}/yolandi/v1/workflow`,window.location.origin);k.searchParams.set("baseKey",e),k.searchParams.set("rel",r.rel);const b=await fetch(k.toString(),{credentials:"same-origin"}),l=await b.json();if(!b.ok||l!=null&&l.error)throw new Error((l==null?void 0:l.error)||`HTTP ${b.status}`);const y={baseKey:e,rel:l.rel,name:l.name,content:String((t=l.content)!=null?t:""),mtime:l.mtime||null};window.dispatchEvent(new CustomEvent("yolandi:open-workflow",{detail:y})),document.dispatchEvent(new CustomEvent("yolandi:open-workflow",{detail:y,bubbles:!0,composed:!0})),window.dispatchEvent(new CustomEvent("open-workflow",{detail:y})),document.dispatchEvent(new CustomEvent("open-workflow",{detail:y,bubbles:!0,composed:!0})),(m=window.YOLANDI)!=null&&m.openWorkflowTab&&window.YOLANDI.openWorkflowTab(y)}catch(g){alert(`Failed to open workflow: ${g.message}`),console.error(g)}},[]),_=u.trim().toLowerCase(),S=i.useMemo(()=>{if(!_)return n;const e=t=>t.toLowerCase().includes(_),r=t=>{if(t.type==="file")return e(t.name)?t:null;const m=(t.children||[]).map(r).filter(Boolean);return m.length||e(t.name)?{...t,children:m}:null};return n.map(t=>({...t,tree:(t.tree||[]).map(r).filter(Boolean)}))},[n,_]);return o.jsxs("div",{className:"yol-wfs",children:[o.jsxs("div",{className:"yol-wfs__hdr",children:[o.jsx("div",{className:"yol-wfs__title",children:"Workflows"}),p?o.jsx("div",{style:{fontSize:12,opacity:.7},children:"Loadingâ€¦"}):null]}),o.jsx("div",{className:"yol-wfs__search",children:o.jsx("input",{type:"search",placeholder:"Search workflowsâ€¦",value:u,onChange:e=>x(e.target.value)})}),o.jsxs("div",{className:"yol-wfs__tree",children:[a&&o.jsx("div",{style:{color:"#f66",margin:"8px 10px"},children:a}),S.length===0&&!p&&!a&&o.jsx("div",{className:"yol-empty",children:"No workflows yet."}),S.map(e=>o.jsxs("div",{className:"yol-wfs__section",children:[o.jsx("div",{className:"yol-wfs__sectionTitle",children:e.label}),(e.tree||[]).map(r=>{var t;return o.jsx(N,{node:r,baseKey:e.baseKey,depth:0,expanded:c,toggle:C,onOpen:T},`${r.type}-${(t=r.rel)!=null?t:r.name}`)})]},e.baseKey))]})]})}return{id:j.id,title:j.title,icon:j.icon,render:()=>o.jsx(s,{})}}export{P as create,j as meta};
